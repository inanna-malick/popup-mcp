{
  "title": "API Performance Diagnosis - Response Time Spike (200ms -> 8s)",
  "elements": [
    {
      "text": "Critical performance degradation detected. Let's quickly narrow down the root cause.",
      "id": "intro_text"
    },
    {
      "choice": "When did the slowdown begin?",
      "id": "slowdown_timing",
      "options": ["After our deployment 2 hours ago", "Gradual degradation over past 5-7 days", "Intermittent - comes and goes", "None of these patterns match our situation"],
      "After our deployment 2 hours ago": [
        {
          "text": "Recent change investigation path - focusing on deployment-related issues",
          "id": "deployment_path"
        },
        {
          "multiselect": "Which deployment changes occurred? (check all that apply)",
          "id": "deployment_changes",
          "options": ["New API endpoints added", "Database migrations ran", "Updated dependencies/packages", "Config/environment changes"],
          "New API endpoints added": [
            {
              "checkbox": "Are the NEW endpoints slow, or existing ones?",
              "id": "new_endpoints_affected",
              "reveals": [
                {
                  "text": "If new endpoints only: Check for missing indexes, N+1 queries, or unoptimized ORM calls in new code",
                  "id": "new_endpoint_advice"
                }
              ]
            }
          ],
          "Database migrations ran": [
            {
              "choice": "Migration scope check:",
              "id": "migration_scope",
              "options": ["Added indexes only", "Schema changes (new columns/tables)", "Large data migrations"]
            },
            {
              "text": "Check: SHOW PROCESSLIST for locked tables, pg_stat_activity for blocking queries",
              "id": "migration_check"
            }
          ],
          "Updated dependencies/packages": [
            {
              "textbox": "Which critical dependencies changed? (e.g., ORM version, Redis client)",
              "id": "dependency_changes",
              "placeholder": "List major version changes"
            }
          ],
          "Config/environment changes": [
            {
              "choice": "What type of config changed?",
              "id": "config_type",
              "options": ["Connection pool settings", "Cache TTL/eviction policies", "Rate limiting/throttling", "Feature flags toggled"]
            }
          ]
        },
        {
          "text": "WARNING: Multiple simultaneous changes make root cause identification difficult",
          "id": "multiple_changes_warning",
          "when": "count(@deployment_changes) >= 3"
        },
        {
          "choice": "This looks like a rushed deployment. What's your rollback strategy?",
          "id": "rollback_strategy",
          "options": ["Full rollback to previous version", "Cherry-pick revert specific changes", "Forward-fix with targeted patches", "Canary rollout to isolate problematic change"],
          "when": "count(@deployment_changes) >= 3"
        },
        {
          "group": "Immediate Actions",
          "id": "immediate_actions",
          "elements": [
            {
              "checkbox": "Can we rollback immediately?",
              "id": "can_rollback",
              "reveals": [
                {
                  "choice": "Rollback feasibility:",
                  "id": "rollback_feasibility",
                  "options": ["Yes - initiating rollback", "No - database migrations prevent it", "No - critical fixes in this deploy", "Partial - can revert app but not DB"]
                }
              ]
            },
            {
              "checkbox": "Enable detailed APM tracing for slow transactions",
              "id": "enable_apm",
              "default": true
            }
          ]
        },
        {
          "group": "After 5 minutes, verify impact:",
          "id": "verify_impact",
          "elements": [
            {
              "slider": "Current response time (ms)",
              "id": "current_response_time",
              "min": 200,
              "max": 8000,
              "default": 4000
            },
            {
              "text": "Still slow after initial actions. The real problem might be deeper:",
              "id": "deeper_problem",
              "when": "@current_response_time > 2000"
            },
            {
              "choice": "Pivot investigation to:",
              "id": "pivot_investigation",
              "options": ["It's not the deployment (coincidental timing)", "Cascade failure (multiple interacting issues)", "External dependency degradation", "Client retry storms amplifying the problem"],
              "when": "@current_response_time > 2000"
            }
          ]
        }
      ],
      "Gradual degradation over past 5-7 days": [
        {
          "text": "Capacity/scaling investigation path - focusing on growth and resource exhaustion",
          "id": "capacity_path"
        },
        {
          "multiselect": "Check these metrics for correlation with slowdown timeline:",
          "id": "growth_metrics",
          "options": ["Traffic volume increased", "Database size growing", "Memory/CPU utilization climbing", "Cache hit rates declining"],
          "Traffic volume increased": [
            {
              "slider": "Approximate traffic increase %",
              "id": "traffic_increase",
              "min": 0,
              "max": 500,
              "default": 50
            },
            {
              "choice": "Traffic pattern:",
              "id": "traffic_pattern",
              "options": ["Uniform increase across all endpoints", "Specific endpoint(s) getting hammered", "Bot/scraper traffic spike", "Geographic concentration (single region)"]
            }
          ],
          "Database size growing": [
            {
              "textbox": "Which tables grew most? (check information_schema)",
              "id": "growing_tables",
              "rows": 2
            },
            {
              "checkbox": "Missing indexes on growing tables?",
              "id": "missing_indexes",
              "reveals": [
                {
                  "text": "Run: EXPLAIN ANALYZE on slow queries, check for sequential scans",
                  "id": "explain_analyze"
                }
              ]
            },
            {
              "text": "CROSS-REFERENCE: Since you identified specific endpoints under load, check if THOSE endpoints query these growing tables",
              "id": "cross_reference",
              "when": "selected(@traffic_pattern, Specific endpoint(s) getting hammered)"
            },
            {
              "textbox": "List the specific slow endpoints for correlation:",
              "id": "slow_endpoints",
              "placeholder": "/api/search, /api/user/profile, etc.",
              "when": "selected(@traffic_pattern, Specific endpoint(s) getting hammered)"
            }
          ],
          "Memory/CPU utilization climbing": [
            {
              "choice": "Resource exhaustion type:",
              "id": "resource_type",
              "options": ["Memory pressure (swapping detected)", "CPU throttling (container limits)", "Connection pool exhaustion", "Disk I/O saturation"]
            }
          ],
          "Cache hit rates declining": [
            {
              "choice": "Cache layer affected:",
              "id": "cache_layer",
              "options": ["Redis/Memcached hit rate dropped", "CDN cache misses increased", "Application-level cache invalidation", "Database query cache issues"]
            },
            {
              "text": "Check for cache stampedes during invalidation",
              "id": "cache_stampede"
            }
          ]
        },
        {
          "text": "INSIGHT: Multiple symptoms suggest cascade failure, not single root cause",
          "id": "cascade_insight",
          "when": "count(@growth_metrics) >= 3"
        },
        {
          "choice": "This looks like domino effect. What likely failed FIRST?",
          "id": "cascade_origin",
          "options": ["Single slow query locked everything else", "Memory pressure triggered GC storm", "Connection pool exhaustion caused queuing", "Cache invalidation triggered thundering herd"],
          "when": "count(@growth_metrics) >= 3"
        },
        {
          "group": "Hypothesis Confidence Tracker",
          "id": "hypothesis_tracker",
          "elements": [
            {
              "slider": "Database bottleneck likelihood",
              "id": "db_likelihood",
              "min": 0,
              "max": 100,
              "default": 50
            },
            {
              "slider": "Traffic/DDoS likelihood",
              "id": "traffic_likelihood",
              "min": 0,
              "max": 100,
              "default": 30
            },
            {
              "slider": "Application code issue likelihood",
              "id": "app_likelihood",
              "min": 0,
              "max": 100,
              "default": 40
            },
            {
              "text": "Focus priority: Run database-specific diagnostics first",
              "id": "db_priority",
              "when": "@db_likelihood > 70"
            },
            {
              "textbox": "Run these DB queries NOW:",
              "id": "db_queries",
              "placeholder": "SHOW PROCESSLIST; SELECT * FROM pg_stat_activity WHERE state != 'idle';",
              "rows": 3,
              "when": "@db_likelihood > 70"
            }
          ]
        },
        {
          "group": "Deep Dive Diagnostics",
          "id": "deep_dive",
          "elements": [
            {
              "checkbox": "Run slow query analysis",
              "id": "slow_query_analysis",
              "reveals": [
                {
                  "textbox": "Paste top 3 slow queries from logs:",
                  "id": "slow_queries",
                  "placeholder": "Include execution time and frequency",
                  "rows": 4
                }
              ]
            },
            {
              "checkbox": "Check for lock contention",
              "id": "lock_contention",
              "reveals": [
                {
                  "text": "Commands: SHOW ENGINE INNODB STATUS\\G (MySQL) or pg_locks join (Postgres)",
                  "id": "lock_commands"
                }
              ]
            }
          ]
        }
      ],
      "Intermittent - comes and goes": [
        {
          "text": "Pattern analysis path - looking for triggers and correlations",
          "id": "pattern_path"
        },
        {
          "choice": "Can you identify any pattern?",
          "id": "intermittent_pattern",
          "options": ["Specific times of day (peak hours)", "After certain operations (bulk imports, reports)", "Random - no clear pattern", "Correlates with external service calls"]
        },
        {
          "multiselect": "During slowdowns, what else do you observe?",
          "id": "slowdown_observations",
          "options": ["Specific endpoints affected only", "Database connection spikes", "Third-party API timeouts", "Background job queue depth increases"]
        }
      ],
      "None of these patterns match our situation": [
        {
          "textbox": "Describe what you're observing in detail:",
          "id": "custom_description",
          "placeholder": "Include timing, affected services, error patterns, any unusual behaviors",
          "rows": 3
        },
        {
          "text": "Based on your description, also investigate these unusual suspects:",
          "id": "unusual_suspects"
        },
        {
          "multiselect": "Less common causes to check:",
          "id": "uncommon_causes",
          "options": ["DNS resolution delays (check resolver timeout)", "SSL certificate expiry or validation issues", "IPv4/IPv6 dual-stack failover delays", "Timezone calculation overhead (DST change?)", "Filesystem running out of inodes", "Network MTU/fragmentation issues", "Kernel TCP tuning parameters changed", "Anti-virus/security scanning interference"]
        },
        {
          "group": "Advanced Diagnostics",
          "id": "advanced_diagnostics",
          "elements": [
            {
              "checkbox": "Run network diagnosis",
              "id": "network_diagnosis",
              "reveals": [
                {
                  "text": "Commands: mtr, traceroute, tcpdump, netstat -s",
                  "id": "network_commands"
                }
              ]
            },
            {
              "checkbox": "Check system logs for anomalies",
              "id": "system_logs",
              "reveals": [
                {
                  "text": "Check: dmesg, /var/log/messages, journalctl -xe",
                  "id": "log_commands"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "group": "Team Coordination (if multiple people available)",
      "id": "team_coordination",
      "elements": [
        {
          "multiselect": "Assign team members to parallel investigation paths:",
          "id": "team_assignments",
          "options": ["Alice: Database investigation", "Bob: Application profiling", "Carol: Infrastructure monitoring", "Dave: External dependencies"],
          "Alice: Database investigation": [
            {
              "textbox": "Alice should run these specific queries:",
              "id": "alice_queries",
              "placeholder": "SHOW PROCESSLIST;\nSELECT * FROM pg_stat_activity;\nEXPLAIN ANALYZE [slow query];",
              "rows": 3
            }
          ],
          "Bob: Application profiling": [
            {
              "textbox": "Bob should check:",
              "id": "bob_tasks",
              "placeholder": "Thread dumps: jstack [pid]\nHeap analysis: jmap -heap [pid]\nFlamegraphs: perf record -g",
              "rows": 3
            }
          ],
          "Carol: Infrastructure monitoring": [
            {
              "textbox": "Carol should examine:",
              "id": "carol_tasks",
              "placeholder": "CloudWatch metrics\nDatadog APM traces\nKubernetes pod health",
              "rows": 3
            }
          ],
          "Dave: External dependencies": [
            {
              "textbox": "Dave should verify:",
              "id": "dave_tasks",
              "placeholder": "Third-party API status pages\nCDN performance\nPayment gateway latency",
              "rows": 3
            }
          ]
        }
      ]
    }
  ]
}
