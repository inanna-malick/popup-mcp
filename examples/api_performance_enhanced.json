{
  "title": "API Performance Diagnosis - Response Time Spike (200ms -> 8s)",
  "elements": [
    {
      "text": "Critical performance degradation detected. Let's quickly narrow down the root cause.",
      "id": "intro_text"
    },
    {
      "id": "slowdown_timing",
      "options": [
        "After our deployment 2 hours ago",
        "Gradual degradation over past 5-7 days",
        "Intermittent - comes and goes",
        "None of these patterns match our situation"
      ],
      "After our deployment 2 hours ago": [
        {
          "text": "Recent change investigation path - focusing on deployment-related issues",
          "id": "deployment_path"
        },
        {
          "id": "deployment_changes",
          "options": [
            "New API endpoints added",
            "Database migrations ran",
            "Updated dependencies/packages",
            "Config/environment changes"
          ],
          "New API endpoints added": [
            {
              "id": "new_endpoints_affected",
              "reveals": [
                {
                  "text": "If new endpoints only: Check for missing indexes, N+1 queries, or unoptimized ORM calls in new code",
                  "id": "new_endpoint_advice"
                }
              ],
              "check": "Are the NEW endpoints slow, or existing ones?"
            }
          ],
          "Database migrations ran": [
            {
              "id": "migration_scope",
              "options": [
                "Added indexes only",
                "Schema changes (new columns/tables)",
                "Large data migrations"
              ],
              "select": "Migration scope check:"
            },
            {
              "text": "Check: SHOW PROCESSLIST for locked tables, pg_stat_activity for blocking queries",
              "id": "migration_check"
            }
          ],
          "Updated dependencies/packages": [
            {
              "id": "dependency_changes",
              "placeholder": "List major version changes",
              "input": "Which critical dependencies changed? (e.g., ORM version, Redis client)"
            }
          ],
          "Config/environment changes": [
            {
              "id": "config_type",
              "options": [
                "Connection pool settings",
                "Cache TTL/eviction policies",
                "Rate limiting/throttling",
                "Feature flags toggled"
              ],
              "select": "What type of config changed?"
            }
          ],
          "multi": "Which deployment changes occurred? (check all that apply)"
        },
        {
          "text": "WARNING: Multiple simultaneous changes make root cause identification difficult",
          "id": "multiple_changes_warning",
          "when": "count(deployment_changes) >= 3"
        },
        {
          "id": "rollback_strategy",
          "options": [
            "Full rollback to previous version",
            "Cherry-pick revert specific changes",
            "Forward-fix with targeted patches",
            "Canary rollout to isolate problematic change"
          ],
          "when": "count(deployment_changes) >= 3",
          "select": "This looks like a rushed deployment. What's your rollback strategy?"
        },
        {
          "group": "Immediate Actions",
          "id": "immediate_actions",
          "elements": [
            {
              "id": "can_rollback",
              "reveals": [
                {
                  "id": "rollback_feasibility",
                  "options": [
                    "Yes - initiating rollback",
                    "No - database migrations prevent it",
                    "No - critical fixes in this deploy",
                    "Partial - can revert app but not DB"
                  ],
                  "select": "Rollback feasibility:"
                }
              ],
              "check": "Can we rollback immediately?"
            },
            {
              "id": "enable_apm",
              "default": true,
              "check": "Enable detailed APM tracing for slow transactions"
            }
          ]
        },
        {
          "group": "After 5 minutes, verify impact:",
          "id": "verify_impact",
          "elements": [
            {
              "slider": "Current response time (ms)",
              "id": "current_response_time",
              "min": 200,
              "max": 8000,
              "default": 4000
            },
            {
              "text": "Still slow after initial actions. The real problem might be deeper:",
              "id": "deeper_problem",
              "when": "current_response_time > 2000"
            },
            {
              "id": "pivot_investigation",
              "options": [
                "It's not the deployment (coincidental timing)",
                "Cascade failure (multiple interacting issues)",
                "External dependency degradation",
                "Client retry storms amplifying the problem"
              ],
              "when": "current_response_time > 2000",
              "select": "Pivot investigation to:"
            }
          ]
        }
      ],
      "Gradual degradation over past 5-7 days": [
        {
          "text": "Capacity/scaling investigation path - focusing on growth and resource exhaustion",
          "id": "capacity_path"
        },
        {
          "id": "growth_metrics",
          "options": [
            "Traffic volume increased",
            "Database size growing",
            "Memory/CPU utilization climbing",
            "Cache hit rates declining"
          ],
          "Traffic volume increased": [
            {
              "slider": "Approximate traffic increase %",
              "id": "traffic_increase",
              "min": 0,
              "max": 500,
              "default": 50
            },
            {
              "id": "traffic_pattern",
              "options": [
                "Uniform increase across all endpoints",
                "Specific endpoint(s) getting hammered",
                "Bot/scraper traffic spike",
                "Geographic concentration (single region)"
              ],
              "select": "Traffic pattern:"
            }
          ],
          "Database size growing": [
            {
              "id": "growing_tables",
              "rows": 2,
              "input": "Which tables grew most? (check information_schema)"
            },
            {
              "id": "missing_indexes",
              "reveals": [
                {
                  "text": "Run: EXPLAIN ANALYZE on slow queries, check for sequential scans",
                  "id": "explain_analyze"
                }
              ],
              "check": "Missing indexes on growing tables?"
            },
            {
              "text": "CROSS-REFERENCE: Since you identified specific endpoints under load, check if THOSE endpoints query these growing tables",
              "id": "cross_reference",
              "when": "selected(traffic_pattern, 'Specific endpoint(s') getting hammered)"
            },
            {
              "id": "slow_endpoints",
              "placeholder": "/api/search, /api/user/profile, etc.",
              "when": "selected(traffic_pattern, 'Specific endpoint(s') getting hammered)",
              "input": "List the specific slow endpoints for correlation:"
            }
          ],
          "Memory/CPU utilization climbing": [
            {
              "id": "resource_type",
              "options": [
                "Memory pressure (swapping detected)",
                "CPU throttling (container limits)",
                "Connection pool exhaustion",
                "Disk I/O saturation"
              ],
              "select": "Resource exhaustion type:"
            }
          ],
          "Cache hit rates declining": [
            {
              "id": "cache_layer",
              "options": [
                "Redis/Memcached hit rate dropped",
                "CDN cache misses increased",
                "Application-level cache invalidation",
                "Database query cache issues"
              ],
              "select": "Cache layer affected:"
            },
            {
              "text": "Check for cache stampedes during invalidation",
              "id": "cache_stampede"
            }
          ],
          "multi": "Check these metrics for correlation with slowdown timeline:"
        },
        {
          "text": "INSIGHT: Multiple symptoms suggest cascade failure, not single root cause",
          "id": "cascade_insight",
          "when": "count(growth_metrics) >= 3"
        },
        {
          "id": "cascade_origin",
          "options": [
            "Single slow query locked everything else",
            "Memory pressure triggered GC storm",
            "Connection pool exhaustion caused queuing",
            "Cache invalidation triggered thundering herd"
          ],
          "when": "count(growth_metrics) >= 3",
          "select": "This looks like domino effect. What likely failed FIRST?"
        },
        {
          "group": "Hypothesis Confidence Tracker",
          "id": "hypothesis_tracker",
          "elements": [
            {
              "slider": "Database bottleneck likelihood",
              "id": "db_likelihood",
              "min": 0,
              "max": 100,
              "default": 50
            },
            {
              "slider": "Traffic/DDoS likelihood",
              "id": "traffic_likelihood",
              "min": 0,
              "max": 100,
              "default": 30
            },
            {
              "slider": "Application code issue likelihood",
              "id": "app_likelihood",
              "min": 0,
              "max": 100,
              "default": 40
            },
            {
              "text": "Focus priority: Run database-specific diagnostics first",
              "id": "db_priority",
              "when": "db_likelihood > 70"
            },
            {
              "id": "db_queries",
              "placeholder": "SHOW PROCESSLIST; SELECT * FROM pg_stat_activity WHERE state != 'idle';",
              "rows": 3,
              "when": "db_likelihood > 70",
              "input": "Run these DB queries NOW:"
            }
          ]
        },
        {
          "group": "Deep Dive Diagnostics",
          "id": "deep_dive",
          "elements": [
            {
              "id": "slow_query_analysis",
              "reveals": [
                {
                  "id": "slow_queries",
                  "placeholder": "Include execution time and frequency",
                  "rows": 4,
                  "input": "Paste top 3 slow queries from logs:"
                }
              ],
              "check": "Run slow query analysis"
            },
            {
              "id": "lock_contention",
              "reveals": [
                {
                  "text": "Commands: SHOW ENGINE INNODB STATUS\\G (MySQL) or pg_locks join (Postgres)",
                  "id": "lock_commands"
                }
              ],
              "check": "Check for lock contention"
            }
          ]
        }
      ],
      "Intermittent - comes and goes": [
        {
          "text": "Pattern analysis path - looking for triggers and correlations",
          "id": "pattern_path"
        },
        {
          "id": "intermittent_pattern",
          "options": [
            "Specific times of day (peak hours)",
            "After certain operations (bulk imports, reports)",
            "Random - no clear pattern",
            "Correlates with external service calls"
          ],
          "select": "Can you identify any pattern?"
        },
        {
          "id": "slowdown_observations",
          "options": [
            "Specific endpoints affected only",
            "Database connection spikes",
            "Third-party API timeouts",
            "Background job queue depth increases"
          ],
          "multi": "During slowdowns, what else do you observe?"
        }
      ],
      "None of these patterns match our situation": [
        {
          "id": "custom_description",
          "placeholder": "Include timing, affected services, error patterns, any unusual behaviors",
          "rows": 3,
          "input": "Describe what you're observing in detail:"
        },
        {
          "text": "Based on your description, also investigate these unusual suspects:",
          "id": "unusual_suspects"
        },
        {
          "id": "uncommon_causes",
          "options": [
            "DNS resolution delays (check resolver timeout)",
            "SSL certificate expiry or validation issues",
            "IPv4/IPv6 dual-stack failover delays",
            "Timezone calculation overhead (DST change?)",
            "Filesystem running out of inodes",
            "Network MTU/fragmentation issues",
            "Kernel TCP tuning parameters changed",
            "Anti-virus/security scanning interference"
          ],
          "multi": "Less common causes to check:"
        },
        {
          "group": "Advanced Diagnostics",
          "id": "advanced_diagnostics",
          "elements": [
            {
              "id": "network_diagnosis",
              "reveals": [
                {
                  "text": "Commands: mtr, traceroute, tcpdump, netstat -s",
                  "id": "network_commands"
                }
              ],
              "check": "Run network diagnosis"
            },
            {
              "id": "system_logs",
              "reveals": [
                {
                  "text": "Check: dmesg, /var/log/messages, journalctl -xe",
                  "id": "log_commands"
                }
              ],
              "check": "Check system logs for anomalies"
            }
          ]
        }
      ],
      "select": "When did the slowdown begin?"
    },
    {
      "group": "Team Coordination (if multiple people available)",
      "id": "team_coordination",
      "elements": [
        {
          "id": "team_assignments",
          "options": [
            "Alice: Database investigation",
            "Bob: Application profiling",
            "Carol: Infrastructure monitoring",
            "Dave: External dependencies"
          ],
          "Alice: Database investigation": [
            {
              "id": "alice_queries",
              "placeholder": "SHOW PROCESSLIST;\nSELECT * FROM pg_stat_activity;\nEXPLAIN ANALYZE [slow query];",
              "rows": 3,
              "input": "Alice should run these specific queries:"
            }
          ],
          "Bob: Application profiling": [
            {
              "id": "bob_tasks",
              "placeholder": "Thread dumps: jstack [pid]\nHeap analysis: jmap -heap [pid]\nFlamegraphs: perf record -g",
              "rows": 3,
              "input": "Bob should check:"
            }
          ],
          "Carol: Infrastructure monitoring": [
            {
              "id": "carol_tasks",
              "placeholder": "CloudWatch metrics\nDatadog APM traces\nKubernetes pod health",
              "rows": 3,
              "input": "Carol should examine:"
            }
          ],
          "Dave: External dependencies": [
            {
              "id": "dave_tasks",
              "placeholder": "Third-party API status pages\nCDN performance\nPayment gateway latency",
              "rows": 3,
              "input": "Dave should verify:"
            }
          ],
          "multi": "Assign team members to parallel investigation paths:"
        }
      ]
    }
  ]
}