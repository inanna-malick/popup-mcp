{
  "title": "API Performance Diagnosis - Response Time Spike (200ms -> 8s)",
  "elements": [
    {
      "text": "Critical performance degradation detected. Let's quickly narrow down the root cause.",
      "id": "intro_text"
    },
    {
      "id": "slowdown_timing",
      "options": [
        "After our deployment 2 hours ago",
        "Gradual degradation over past 5-7 days",
        "Intermittent - comes and goes"
      ],
      "After our deployment 2 hours ago": [
        {
          "text": "Recent change investigation path - focusing on deployment-related issues",
          "id": "deployment_path"
        },
        {
          "id": "deployment_changes",
          "options": [
            "New API endpoints added",
            "Database migrations ran",
            "Updated dependencies/packages",
            "Config/environment changes"
          ],
          "New API endpoints added": [
            {
              "id": "new_endpoints_slow",
              "reveals": [
                {
                  "text": "If new endpoints only: Check for missing indexes, N+1 queries, or unoptimized ORM calls in new code",
                  "id": "new_endpoint_advice"
                }
              ],
              "check": "Are the NEW endpoints slow, or existing ones?"
            }
          ],
          "Database migrations ran": [
            {
              "id": "migration_scope",
              "options": [
                "Added indexes only",
                "Schema changes (new columns/tables)",
                "Large data migrations"
              ],
              "select": "Migration scope check:"
            },
            {
              "text": "Check: SHOW PROCESSLIST for locked tables, pg_stat_activity for blocking queries",
              "id": "migration_check"
            }
          ],
          "Updated dependencies/packages": [
            {
              "id": "dependency_changes",
              "placeholder": "List major version changes",
              "input": "Which critical dependencies changed? (e.g., ORM version, Redis client)"
            }
          ],
          "Config/environment changes": [
            {
              "id": "config_type",
              "options": [
                "Connection pool settings",
                "Cache TTL/eviction policies",
                "Rate limiting/throttling",
                "Feature flags toggled"
              ],
              "select": "What type of config changed?"
            }
          ],
          "multi": "Which deployment changes occurred? (check all that apply)"
        },
        {
          "group": "Immediate Actions",
          "id": "immediate_actions",
          "elements": [
            {
              "id": "can_rollback",
              "reveals": [
                {
                  "id": "rollback_feasibility",
                  "options": [
                    "Yes - initiating rollback",
                    "No - database migrations prevent it",
                    "No - critical fixes in this deploy",
                    "Partial - can revert app but not DB"
                  ],
                  "select": "Rollback feasibility:"
                }
              ],
              "check": "Can we rollback immediately?"
            },
            {
              "id": "enable_apm",
              "default": true,
              "check": "Enable detailed APM tracing for slow transactions"
            }
          ]
        }
      ],
      "Gradual degradation over past 5-7 days": [
        {
          "text": "Capacity/scaling investigation path - focusing on growth and resource exhaustion",
          "id": "capacity_path"
        },
        {
          "id": "growth_metrics",
          "options": [
            "Traffic volume increased",
            "Database size growing",
            "Memory/CPU utilization climbing",
            "Cache hit rates declining"
          ],
          "Traffic volume increased": [
            {
              "slider": "Approximate traffic increase %",
              "id": "traffic_increase",
              "min": 0,
              "max": 500,
              "default": 50
            },
            {
              "id": "traffic_pattern",
              "options": [
                "Uniform increase across all endpoints",
                "Specific endpoint(s) getting hammered",
                "Bot/scraper traffic spike",
                "Geographic concentration (single region)"
              ],
              "select": "Traffic pattern:"
            }
          ],
          "Database size growing": [
            {
              "id": "growing_tables",
              "rows": 2,
              "input": "Which tables grew most? (check information_schema)"
            },
            {
              "id": "missing_indexes",
              "reveals": [
                {
                  "text": "Run: EXPLAIN ANALYZE on slow queries, check for sequential scans",
                  "id": "explain_analyze"
                }
              ],
              "check": "Missing indexes on growing tables?"
            }
          ],
          "Memory/CPU utilization climbing": [
            {
              "id": "resource_type",
              "options": [
                "Memory pressure (swapping detected)",
                "CPU throttling (container limits)",
                "Connection pool exhaustion",
                "Disk I/O saturation"
              ],
              "select": "Resource exhaustion type:"
            }
          ],
          "Cache hit rates declining": [
            {
              "id": "cache_layer",
              "options": [
                "Redis/Memcached hit rate dropped",
                "CDN cache misses increased",
                "Application-level cache invalidation",
                "Database query cache issues"
              ],
              "select": "Cache layer affected:"
            },
            {
              "text": "Check for cache stampedes during invalidation",
              "id": "cache_stampede"
            }
          ],
          "multi": "Check these metrics for correlation with slowdown timeline:"
        },
        {
          "group": "Deep Dive Diagnostics",
          "id": "deep_dive",
          "elements": [
            {
              "id": "slow_query_analysis",
              "reveals": [
                {
                  "id": "slow_queries",
                  "placeholder": "Include execution time and frequency",
                  "rows": 4,
                  "input": "Paste top 3 slow queries from logs:"
                }
              ],
              "check": "Run slow query analysis"
            },
            {
              "id": "lock_contention",
              "reveals": [
                {
                  "text": "Commands: SHOW ENGINE INNODB STATUS\\G (MySQL) or pg_locks join (Postgres)",
                  "id": "lock_commands"
                }
              ],
              "check": "Check for lock contention"
            }
          ]
        }
      ],
      "Intermittent - comes and goes": [
        {
          "text": "Pattern analysis path - looking for triggers and correlations",
          "id": "pattern_path"
        },
        {
          "id": "intermittent_pattern",
          "options": [
            "Specific times of day (peak hours)",
            "After certain operations (bulk imports, reports)",
            "Random - no clear pattern",
            "Correlates with external service calls"
          ],
          "select": "Can you identify any pattern?"
        },
        {
          "id": "slowdown_observations",
          "options": [
            "Specific endpoints affected only",
            "Database connection spikes",
            "Third-party API timeouts",
            "Background job queue depth increases"
          ],
          "multi": "During slowdowns, what else do you observe?"
        }
      ],
      "select": "When did the slowdown begin?"
    }
  ]
}